{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://cerro-torre.org/schemas/keystore-policy.json",
  "policy_version": "1.0",
  "purpose": "password_kdf_for_local_keystore_only",
  "algorithm": {
    "id": "argon2id",
    "version": 19
  },
  "encoding": {
    "format": "phc_string",
    "example_shape": "$argon2id$v=19$m=65536,t=3,p=1$<salt_b64>$<hash_b64>"
  },
  "defaults": {
    "profile": "interactive",
    "salt_bytes": 16,
    "hash_bytes": 32,
    "parallelism": 1,
    "memory_kib": 131072,
    "time_cost": 3
  },
  "profiles": [
    {
      "name": "interactive",
      "intended_use": "human_unlock_of_local_keystore",
      "salt_bytes": 16,
      "hash_bytes": 32,
      "parallelism": 1,
      "memory_kib": 131072,
      "time_cost": 3
    },
    {
      "name": "moderate",
      "intended_use": "ci_or_password_manager_like_unlock",
      "salt_bytes": 16,
      "hash_bytes": 32,
      "parallelism": 2,
      "memory_kib": 262144,
      "time_cost": 4
    },
    {
      "name": "high",
      "intended_use": "high_value_local_keystore_unlock",
      "salt_bytes": 16,
      "hash_bytes": 32,
      "parallelism": 4,
      "memory_kib": 524288,
      "time_cost": 5
    }
  ],
  "constraints": {
    "salt_bytes": { "min": 16, "max": 32 },
    "hash_bytes": { "min": 32, "max": 64 },
    "parallelism": { "min": 1, "max": 8 },
    "memory_kib": { "min": 65536, "max": 1048576 },
    "time_cost": { "min": 2, "max": 10 }
  },
  "invariants": [
    "This policy MUST NOT be used for artifact hashing, content addressing, canonical digests, or manifest/summary binding digests.",
    "All password-derived secrets MUST use argon2id with parameters satisfying constraints.",
    "Implementations MUST store the derived key verifier as a PHC string (argon2id) and MUST NOT store raw passwords.",
    "Implementations SHOULD allow policy upgrade (re-hash on unlock) when defaults/profile parameters increase."
  ],
  "upgrade": {
    "strategy": "rehash_on_successful_unlock",
    "allow_profile_change": true,
    "allow_increase_only": true
  }
}
