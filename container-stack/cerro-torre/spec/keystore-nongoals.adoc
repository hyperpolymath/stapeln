= Keystore Policy: Explicit Non-Goals
:status: normative
:audience: implementers, auditors

== Purpose

This document explicitly defines what the keystore policy (spec/keystore-policy.json) MUST NOT be used for.
These are architectural invariants that CI and shadow verifiers should enforce.

== Non-Goals (MUST NOT)

=== NG-1: Artifact Hashing

The keystore policy MUST NOT be used for:

* Content-addressed storage
* Manifest canonical digests
* Summary binding digests
* SBOM hashes
* OCI layer digests
* Any provenance chain hashing

**Rationale**: Argon2id is a password-based KDF, not a content hash. Using it for artifacts would be:
* Computationally expensive (intentionally slow)
* Non-deterministic across implementations
* Semantically wrong (artifacts are not secrets)

**Correct usage**: SHA-256 for all artifact binding (see spec/crypto-suites.json).

=== NG-2: Remote Authentication

The keystore policy MUST NOT be used for:

* Network authentication tokens
* API keys
* Session tokens
* OAuth/OIDC flows

**Rationale**: These require different security models (time-limited, revocable, possibly hardware-bound).

=== NG-3: Inter-Process Secrets

The keystore policy MUST NOT be used for:

* IPC authentication
* Secrets shared between processes
* Container-to-container secrets

**Rationale**: These should use ephemeral keys or sealed secrets, not password-derived material.

=== NG-4: Key Derivation for Signing

The keystore policy MUST NOT be used for:

* Deriving signing keys from passwords
* Generating Ed25519/ML-DSA keys from passphrases

**Rationale**: Signing keys should be generated with proper entropy, not password-derived.
Password-protected keystores encrypt the key material, not derive it.

=== NG-5: Hardware Key Bypass

The keystore policy MUST NOT:

* Be presented as equivalent to hardware key protection
* Bypass hardware token requirements when policy mandates them

**Rationale**: Password-protected software keystores are a fallback, not a replacement for HSM/TPM.

== Enforcement

=== CI Checks

The following CI checks SHOULD be implemented:

[source,yaml]
----
keystore-boundary:
  script:
    # Ensure keystore policy is not referenced in artifact code paths
    - grep -r "argon2" src/core/ src/attestations/ && exit 1 || true
    # Validate policy file against schema
    - jsonschema -i spec/keystore-policy.json spec/keystore-policy.schema.json
----

=== Code Review

Reviewers SHOULD reject:

* Any `import` of Argon2 in artifact hashing modules
* Any reference to keystore-policy in provenance generation
* Any password-derived signing keys

== Allowed Usages

For clarity, the keystore policy IS intended for:

* Encrypting local key material at rest
* Password-protecting developer keystores
* CI service account keystores (with appropriate profile)

== Related Documents

* spec/keystore-policy.json — The policy being constrained
* spec/crypto-suites.json — What to use for artifact operations
* docs/crypto-suites.adoc — Suite commitment documentation
