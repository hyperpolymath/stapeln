// SPDX-License-Identifier: PMPL-1.0-or-later
= Security Standards Mapping by Component
:toc: left

== Executive Summary

This document maps the svalinn-project security standards to each component in the verified container ecosystem:

- **Cerro Torre (ct)**: Container build/signing tool
- **Svalinn**: Edge gateway (reverse proxy, TLS termination)
- **VÃ¶rÃ°r**: Container verification & runtime monitoring
- **selur**: Zero-copy IPC bridge (WASM)
- **verified-container-spec**: Protocol specification

Each component has different security requirements based on its role.

== Component-by-Component Analysis

=== Cerro Torre (ct) - Container Build & Signing

**Role:** Build, sign, and verify container bundles (.ctp files)

**Security Requirements from Svalinn Spec:**

[cols="2,1,3",options="header"]
|===
| Requirement | Priority | Rationale

| **PQ Signatures (ML-DSA-87)**
| ğŸ”´ CRITICAL
| Signs containers for long-term integrity (20+ year lifespan)

| **Classical Signatures (Ed448)**
| ğŸŸ¡ HIGH
| Hybrid with ML-DSA-87 for defense-in-depth

| **General Hashing (SHAKE3-512)**
| ğŸŸ¡ HIGH
| Bundle integrity, provenance, SBOM hashing

| **Database Hashing (BLAKE3-512)**
| ğŸŸ¢ MEDIUM
| Fast hashing for large files (layers, blobs)

| **Formal Verification (Coq/Isabelle)**
| âœ… DONE
| Uses Ada/SPARK + Idris2 (R-variants) + ATS2 (X-variants)

| **Fallback PQ Signature (SPHINCS+)**
| ğŸŸ¢ MEDIUM
| Conservative backup if ML-DSA-87 breaks

| âŒ Password Hashing (Argon2id)
| N/A
| No passwords (uses public key crypto)

| âŒ PQ Key Exchange (Kyber-1024)
| N/A
| No encryption (signs, doesn't encrypt)

| âŒ Symmetric Encryption (XChaCha20)
| N/A
| No encryption

| âŒ KDF (HKDF-SHAKE512)
| N/A
| Keys loaded from files, not derived

| âŒ RNG (ChaCha20-DRBG)
| LOW
| Uses OS RNG (sufficient for signing)

| âŒ Protocol Stack (HTTP/3, IPv6)
| ğŸŸ¢ MEDIUM
| Registry communication (HTTP/2 â†’ HTTP/3 upgrade)

| âŒ Accessibility (WCAG)
| N/A
| CLI tool, not a web app

|===

**Current Status:** 40% compliant (classical crypto done, PQ crypto stubbed)

**Critical Gap:** ML-DSA-87 implementation (awaiting liboqs bindings)

---

=== Svalinn - Edge Gateway & Reverse Proxy

**Role:** HTTP reverse proxy, TLS termination, rate limiting, API gateway

**Security Requirements from Svalinn Spec:**

[cols="2,1,3",options="header"]
|===
| Requirement | Priority | Rationale

| **Protocol Stack (QUIC + HTTP/3 + IPv6)**
| ğŸ”´ CRITICAL
| Core feature - HTTP/3 for 0-RTT, QUIC for multiplexing

| **Symmetric Encryption (XChaCha20-Poly1305)**
| ğŸ”´ CRITICAL
| TLS 1.3 cipher suite for HTTPS termination

| **PQ Key Exchange (Kyber-1024)**
| ğŸ”´ CRITICAL
| Post-quantum TLS handshakes (ML-KEM-1024)

| **KDF (HKDF-SHAKE512)**
| ğŸ”´ CRITICAL
| Session key derivation from TLS master secret

| **RNG (ChaCha20-DRBG)**
| ğŸ”´ CRITICAL
| Session IDs, nonces, CSRF tokens

| **General Hashing (SHAKE3-512)**
| ğŸŸ¡ HIGH
| HMAC for cookies, integrity tags

| **Database Hashing (BLAKE3-512)**
| ğŸŸ¡ HIGH
| Fast response caching, ETag generation

| **Classical Signatures (Ed448)**
| ğŸŸ¢ MEDIUM
| JWT signing for API auth (if used)

| **PQ Signatures (ML-DSA-87)**
| ğŸŸ¢ MEDIUM
| JWT signing (hybrid with Ed448)

| âŒ Password Hashing (Argon2id)
| LOW
| Only if implementing user auth (not core feature)

| âŒ Formal Verification
| ğŸŸ¢ MEDIUM
| ReScript type safety + property tests (not SPARK-level)

| âŒ Accessibility (WCAG)
| N/A
| Reverse proxy, not a web app

|===

**Current Status:** Unknown (Svalinn repo not found in current scan)

**Critical Gaps:**
- QUIC/HTTP/3 support (check if implemented)
- PQ-TLS (Kyber-1024 KEM)
- XChaCha20-Poly1305 cipher suite

**Note:** Svalinn may delegate crypto to underlying libraries (Deno's native TLS). Need to verify:
- Does Deno support QUIC/HTTP/3?
- Does Deno support PQ-TLS (Kyber)?
- Can Deno use XChaCha20-Poly1305?

---

=== VÃ¶rÃ°r - Container Verification & Runtime Monitoring

**Role:** Verify container attestations, monitor runtime syscalls (eBPF)

**Security Requirements from Svalinn Spec:**

[cols="2,1,3",options="header"]
|===
| Requirement | Priority | Rationale

| **PQ Signatures (ML-DSA-87)**
| ğŸ”´ CRITICAL
| Verify Cerro Torre bundle signatures

| **Classical Signatures (Ed448)**
| ğŸŸ¡ HIGH
| Verify hybrid signatures (Ed448 + ML-DSA-87)

| **General Hashing (SHAKE3-512)**
| ğŸŸ¡ HIGH
| Verify bundle hashes, SBOM integrity

| **Database Hashing (BLAKE3-512)**
| ğŸŸ¡ HIGH
| Policy storage, audit logs (uses Virtuoso VOS per spec?)

| **Formal Verification (Idris2)**
| âœ… DONE
| VÃ¶rÃ°r uses Idris2 for lifecycle proofs

| **Semantic XML/GraphQL (Virtuoso + SPARQL)**
| ğŸŸ¡ HIGH
| Policy storage with WCAG 2.3 compliance (if building UI)

| âŒ Password Hashing (Argon2id)
| N/A
| No user auth (verifies containers, not users)

| âŒ PQ Key Exchange (Kyber-1024)
| N/A
| No encryption

| âŒ Symmetric Encryption (XChaCha20)
| N/A
| No encryption

| âŒ KDF (HKDF-SHAKE512)
| LOW
| May need for session tokens if exposing API

| âŒ RNG (ChaCha20-DRBG)
| ğŸŸ¢ MEDIUM
| Nonces for audit logs, policy enforcement

| âŒ Protocol Stack (HTTP/3)
| ğŸŸ¢ MEDIUM
| If exposing API (Elixir Phoenix backend)

| âŒ Accessibility (WCAG 2.3 AAA)
| ğŸŸ¢ MEDIUM
| Only if building ReScript browser UI (per ECOSYSTEM.scm)

|===

**Current Status:** Unknown (VÃ¶rÃ°r repo exists but crypto implementation unclear)

**Critical Gaps:**
- ML-DSA-87 verification (must match Cerro Torre)
- BLAKE3-512 for fast policy lookups
- Virtuoso VOS database (if using semantic XML/SPARQL)

**Integration Point:** VÃ¶rÃ°r calls Cerro Torre's verification libraries (Ada crypto bindings?)

---

=== selur - Zero-Copy IPC Bridge (WASM)

**Role:** Memory-safe IPC between Svalinn and VÃ¶rÃ°r (WASM linear memory)

**Security Requirements from Svalinn Spec:**

[cols="2,1,3",options="header"]
|===
| Requirement | Priority | Rationale

| **Formal Verification (Idris2)**
| âœ… DONE
| Uses Idris2 proofs for memory safety (no lost requests, no leaks)

| **Symmetric Encryption (XChaCha20)**
| ğŸŸ¢ MEDIUM
| Encrypt IPC messages if crossing trust boundaries

| **General Hashing (SHAKE3-512)**
| ğŸŸ¢ MEDIUM
| HMAC for IPC message authentication

| **RNG (ChaCha20-DRBG)**
| LOW
| Nonces for encrypted IPC (if implemented)

| âŒ Signatures (Ed448, ML-DSA-87)
| N/A
| IPC doesn't need signatures (same trust domain)

| âŒ Password Hashing
| N/A
| No user auth

| âŒ PQ Key Exchange (Kyber)
| N/A
| Shared memory (not network)

| âŒ KDF
| N/A
| No key derivation

| âŒ Database Hashing
| N/A
| No database

| âŒ Protocol Stack (HTTP/3)
| N/A
| WASM shared memory, not HTTP

| âŒ Accessibility (WCAG)
| N/A
| IPC bridge, no UI

|===

**Current Status:** MVP complete (v1.0.0), encryption not implemented

**Critical Gaps:**
- **None** for current trust model (Svalinn + VÃ¶rÃ°r in same process)
- If deploying Svalinn and VÃ¶rÃ°r on separate hosts: need XChaCha20-Poly1305 + HMAC

**Note:** selur's security model assumes Svalinn and VÃ¶rÃ°r share a trust boundary. If untrusted network between them, need to add:
1. XChaCha20-Poly1305 for confidentiality
2. SHAKE3-512 HMAC for authenticity
3. ChaCha20-DRBG for nonces

---

=== verified-container-spec - Protocol Specification

**Role:** Defines .ctp bundle format, attestation structure, verification protocol

**Security Requirements from Svalinn Spec:**

[cols="2,1,3",options="header"]
|===
| Requirement | Priority | Rationale

| **PQ Signatures (ML-DSA-87)**
| ğŸ”´ CRITICAL
| Spec MUST mandate ML-DSA-87 for long-term integrity

| **Classical Signatures (Ed448)**
| ğŸ”´ CRITICAL
| Spec MUST mandate hybrid Ed448 + ML-DSA-87

| **General Hashing (SHAKE3-512)**
| ğŸ”´ CRITICAL
| Spec MUST mandate SHAKE3-512 for bundle hashes

| **Fallback PQ Signature (SPHINCS+)**
| ğŸŸ¡ HIGH
| Spec SHOULD allow SPHINCS+ as optional fallback

| **Database Hashing (BLAKE3-512)**
| ğŸŸ¢ MEDIUM
| Spec MAY allow BLAKE3-512 for performance-critical paths

| **User-Friendly Hash Names**
| ğŸŸ¢ MEDIUM
| Spec SHOULD define Base32(SHAKE256) + wordlist for human-readable IDs

| âŒ Symmetric Encryption
| N/A
| Spec is for signing, not encryption

| âŒ PQ Key Exchange
| N/A
| Spec is for signatures, not key exchange

| âŒ KDF
| N/A
| Spec doesn't derive keys

| âŒ Password Hashing
| N/A
| Spec doesn't cover user auth

| âŒ RNG
| N/A
| Implementation detail, not spec

| âŒ Protocol Stack
| N/A
| Spec defines bundle format, not transport

| âŒ Accessibility
| N/A
| Technical spec, not UI

|===

**Current Status:** Unknown (repo not found in current scan)

**Critical Requirements for Spec:**

```yaml
# verified-container-spec MUST mandate:
signature_algorithms:
  required:
    - CT-SIG-02  # Ed448 + ML-DSA-87 hybrid
  optional:
    - ML-DSA-87  # Pure PQ
    - SPHINCS+   # Conservative fallback

hash_algorithms:
  required:
    - SHAKE3-512  # Bundle hashes, provenance
  optional:
    - BLAKE3-512  # Performance-critical paths

attestation_format:
  required:
    - in-toto     # SLSA provenance
    - CycloneDX   # SBOM (security-focused)
  optional:
    - SPDX        # Alternative SBOM format
```

---

== Cross-Component Integration Points

=== 1. Cerro Torre â†’ VÃ¶rÃ°r (Signature Verification)

**Data Flow:**
```
Cerro Torre (signs bundle with CT-SIG-02)
    â†“
VÃ¶rÃ°r (verifies signature using same crypto library)
```

**Shared Requirements:**
- ML-DSA-87 implementation (liboqs)
- Ed448 implementation
- SHAKE3-512 hashing
- MUST use identical crypto library (avoid divergence)

**Recommendation:** Extract crypto into shared Ada package:
```
cerro-crypto/           # Shared crypto library (Ada/SPARK)
  â”œâ”€â”€ libcerro_crypto.so
  â”œâ”€â”€ cerro_crypto.ads
  â”œâ”€â”€ cerro_crypto.adb
  â”œâ”€â”€ ct_pqcrypto.ads
  â””â”€â”€ ct_pqcrypto.adb
```

Used by:
- Cerro Torre (Ada binary)
- VÃ¶rÃ°r (Ada bindings via Rust FFI)

---

=== 2. Svalinn â†’ selur â†’ VÃ¶rÃ°r (IPC)

**Data Flow:**
```
Svalinn (receives HTTPS request)
    â†“
selur (zero-copy IPC via WASM)
    â†“
VÃ¶rÃ°r (verifies container, returns decision)
    â†“
selur (zero-copy IPC via WASM)
    â†“
Svalinn (returns HTTPS response)
```

**Security Boundary:**

If Svalinn and VÃ¶rÃ°r are in the same process (current design):
- âœ… No encryption needed (shared memory)
- âœ… Ephapax-linear prevents memory leaks
- âœ… Idris2 proofs ensure correctness

If Svalinn and VÃ¶rÃ°r are on different hosts (future design):
- âŒ Need XChaCha20-Poly1305 encryption
- âŒ Need SHAKE3-512 HMAC authentication
- âŒ Need ChaCha20-DRBG for nonces

**Recommendation:** Keep co-located for now (security + performance)

---

=== 3. Svalinn â†’ Internet (TLS Termination)

**Data Flow:**
```
Client (HTTPS/QUIC request)
    â†“
Svalinn (TLS 1.3 termination, QUIC multiplexing)
    â†“
[Internal routing]
```

**Critical Requirements:**
- QUIC/HTTP/3 support
- PQ-TLS (Kyber-1024 + X25519 hybrid KEM)
- XChaCha20-Poly1305 cipher suite
- HKDF-SHAKE512 for session key derivation

**Current Gap:** Deno's native TLS stack support?

Check:
1. Does Deno's `Deno.serve()` support QUIC/HTTP/3?
2. Does Deno support PQ-TLS (via BoringSSL or OQS-OpenSSL)?
3. Can Deno use XChaCha20-Poly1305 (non-standard cipher)?

If not, may need to:
- Wrap with nginx/Caddy (both support HTTP/3)
- Use Rust TLS library (rustls + PQ extensions)
- Contribute PQ-TLS support to Deno

---

== Summary Table: Who Needs What

[cols="2,1,1,1,1,1",options="header"]
|===
| Security Feature | Cerro Torre | Svalinn | VÃ¶rÃ°r | selur | Spec

| **PQ Signatures (ML-DSA-87)**
| ğŸ”´ CRITICAL
| ğŸŸ¢ MEDIUM
| ğŸ”´ CRITICAL
| N/A
| ğŸ”´ CRITICAL

| **Classical Signatures (Ed448)**
| ğŸŸ¡ HIGH
| ğŸŸ¢ MEDIUM
| ğŸŸ¡ HIGH
| N/A
| ğŸ”´ CRITICAL

| **PQ Key Exchange (Kyber-1024)**
| N/A
| ğŸ”´ CRITICAL
| N/A
| N/A
| N/A

| **Symmetric Encryption (XChaCha20)**
| N/A
| ğŸ”´ CRITICAL
| N/A
| ğŸŸ¢ MEDIUM*
| N/A

| **General Hashing (SHAKE3-512)**
| ğŸŸ¡ HIGH
| ğŸŸ¡ HIGH
| ğŸŸ¡ HIGH
| ğŸŸ¢ MEDIUM
| ğŸ”´ CRITICAL

| **Database Hashing (BLAKE3-512)**
| ğŸŸ¢ MEDIUM
| ğŸŸ¡ HIGH
| ğŸŸ¡ HIGH
| N/A
| ğŸŸ¢ MEDIUM

| **KDF (HKDF-SHAKE512)**
| N/A
| ğŸ”´ CRITICAL
| LOW
| N/A
| N/A

| **RNG (ChaCha20-DRBG)**
| LOW
| ğŸ”´ CRITICAL
| ğŸŸ¢ MEDIUM
| LOW
| N/A

| **Password Hashing (Argon2id)**
| N/A
| LOW
| N/A
| N/A
| N/A

| **Fallback PQ Signature (SPHINCS+)**
| ğŸŸ¢ MEDIUM
| LOW
| ğŸŸ¢ MEDIUM
| N/A
| ğŸŸ¡ HIGH

| **HTTP/3 + IPv6**
| ğŸŸ¢ MEDIUM
| ğŸ”´ CRITICAL
| ğŸŸ¢ MEDIUM
| N/A
| N/A

| **Formal Verification**
| âœ… DONE
| ğŸŸ¢ MEDIUM
| âœ… DONE
| âœ… DONE
| N/A

| **Accessibility (WCAG 2.3 AAA)**
| N/A
| N/A
| ğŸŸ¢ MEDIUM*
| N/A
| N/A

|===

*\* Only if implementing browser UI (VÃ¶rÃ°r has ReScript MCP adapter)*

*\* Only if selur IPC crosses trust boundaries (not current design)*

---

== Implementation Priorities

=== Phase 1: Critical Path (0-3 months)

**Cerro Torre:**
1. Implement ML-DSA-87 (link liboqs)
2. Test CT-SIG-02 hybrid signatures
3. Extract crypto to shared library

**Svalinn:**
1. Verify Deno supports HTTP/3 (or add nginx frontend)
2. Add PQ-TLS support (Kyber-1024 via OQS-OpenSSL)
3. Configure XChaCha20-Poly1305 cipher suite

**VÃ¶rÃ°r:**
1. Link Cerro Torre's crypto library
2. Implement ML-DSA-87 verification
3. Test end-to-end signature verification

**selur:**
- No changes needed (current design is secure)

**verified-container-spec:**
1. Draft v1.0 spec mandating:
   - CT-SIG-02 (Ed448 + ML-DSA-87)
   - SHAKE3-512 hashing
   - CycloneDX SBOM format

---

=== Phase 2: Upgrade Classical Crypto (3-6 months)

**All components:**
1. Upgrade Ed25519 â†’ Ed448
2. Upgrade SHAKE256 â†’ SHAKE3-512
3. Upgrade BLAKE3-256 â†’ BLAKE3-512

---

=== Phase 3: Add Fallbacks (6-9 months)

**Cerro Torre + VÃ¶rÃ°r:**
1. Add SPHINCS+ support (conservative fallback)

**Svalinn:**
1. Add ChaCha20-DRBG (deterministic RNG for testing)

---

=== Phase 4: Polish (9-12 months)

**Cerro Torre:**
1. User-friendly hash names (Base32 + wordlist)

**Svalinn:**
1. IPv6-only mode toggle

**VÃ¶rÃ°r:**
1. WCAG 2.3 AAA compliance for ReScript UI (if building)
2. Virtuoso VOS database for semantic policies

---

== Deviations from Svalinn-Project Spec

The svalinn-project spec includes features that are **out of scope** for a container ecosystem:

**Not Applicable:**
- Password hashing (Argon2id) - No user authentication in any component
- VM/Execution (GraalVM) - Native binaries (Ada, Rust, Zig, Elixir)
- Semantic XML/GraphQL accessibility - Only if building VÃ¶rÃ°r browser UI

**Partially Applicable:**
- Database hashing - Only VÃ¶rÃ°r uses a database (policy storage)
- Accessibility (WCAG) - Only if VÃ¶rÃ°r builds ReScript browser UI

**Fully Applicable:**
- Crypto algorithms (signatures, hashing, KEM, symmetric, KDF, RNG)
- Protocol stack (HTTP/3, IPv6)
- Formal verification (Coq/Isabelle/SPARK/Idris2/ATS2)

---

== Recommendations

=== For Cerro Torre
1. **Prioritize ML-DSA-87** - Critical blocker for PQ resistance
2. **Extract crypto library** - Share with VÃ¶rÃ°r to avoid divergence
3. **Skip out-of-scope features** - No passwords, KEM, symmetric crypto

=== For Svalinn
1. **Verify HTTP/3 support** - Check if Deno native or needs nginx
2. **Add PQ-TLS** - Kyber-1024 KEM via OQS-OpenSSL
3. **Test XChaCha20-Poly1305** - May need custom TLS config

=== For VÃ¶rÃ°r
1. **Reuse Cerro Torre crypto** - Don't duplicate ML-DSA-87 implementation
2. **Defer WCAG compliance** - Only if building browser UI
3. **Defer Virtuoso VOS** - Use simpler DB (PostgreSQL) for MVP

=== For selur
1. **No changes needed** - Current design is secure (co-located process)
2. **Defer encryption** - Only add if deploying across network
3. **Keep Idris2 proofs** - Competitive advantage

=== For verified-container-spec
1. **Mandate CT-SIG-02** - Ed448 + ML-DSA-87 hybrid
2. **Mandate SHAKE3-512** - Long-term integrity hashing
3. **Allow SPHINCS+** - Conservative fallback

---

## Conclusion

**Overall Ecosystem Status:**

- **Cerro Torre:** 40% compliant (classical done, PQ stubbed)
- **Svalinn:** Unknown (repo not scanned, verify HTTP/3 + PQ-TLS)
- **VÃ¶rÃ°r:** Unknown (verify ML-DSA-87 verification)
- **selur:** 95% compliant (Idris2 proofs done, encryption not needed)
- **verified-container-spec:** Not evaluated (repo not found)

**Critical Path:**
1. Cerro Torre: Implement ML-DSA-87 (2-3 months)
2. Svalinn: Add PQ-TLS (Kyber-1024) (1-2 months)
3. VÃ¶rÃ°r: Link Cerro Torre crypto (1 month)
4. Spec: Draft v1.0 with PQ requirements (1 month)

**Timeline:** 6-9 months to full svalinn-project compliance across all components.

**Out of Scope:** ~30% of svalinn-project spec (passwords, VM, some accessibility) doesn't apply to container tooling.
