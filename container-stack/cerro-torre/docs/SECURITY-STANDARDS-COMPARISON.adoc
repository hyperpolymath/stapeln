// SPDX-License-Identifier: PMPL-1.0-or-later
= Cerro Torre Security Standards Comparison
:toc: left

== Executive Summary

This document compares Cerro Torre's current cryptographic implementations against the svalinn-project security standards specification.

**Overall Status:** ‚ö†Ô∏è *Partially Compliant* (40% complete)

Cerro Torre has implemented classical crypto (Ed25519, SHA-256, BLAKE3) but is missing most post-quantum algorithms and modern symmetric primitives.

== Detailed Comparison

[cols="1,2,1,3",options="header"]
|===
| Category | Svalinn-Project Requirement | Status | Cerro Torre Implementation

| **Password Hashing**
| Argon2id (512 MiB, 8 iter, 4 lanes)
| ‚ùå *Not Implemented*
| No password hashing. Not applicable for container signing (uses public key crypto).

| **General Hashing**
| SHAKE3-512 (512-bit output, FIPS 202)
| ‚ö†Ô∏è  *Partial*
| Have: Shake256 (FIPS 202). Need: SHAKE3-512 (stronger variant).

| **PQ Signatures**
| Dilithium5-AES (ML-DSA-87, FIPS 204)
| ‚ö†Ô∏è  *Stub Only*
| API defined in `ct_pqcrypto.ads`, stub implementation. Awaiting liboqs bindings.

| **PQ Key Exchange**
| Kyber-1024 + SHAKE256-KDF (ML-KEM-1024, FIPS 203)
| ‚ùå *Not Implemented*
| No KEM. Not applicable for container signing (uses signatures, not encryption).

| **Classical Signatures**
| Ed448 + Dilithium5 (hybrid)
| ‚ö†Ô∏è  *Partial*
| Have: Ed25519 + ML-DSA-87 hybrid (CT-SIG-02). Need: Upgrade to Ed448.

| **Symmetric Encryption**
| XChaCha20-Poly1305 (256-bit key)
| ‚ùå *Not Implemented*
| No symmetric crypto. Not applicable for container signing.

| **Key Derivation**
| HKDF-SHAKE512
| ‚ùå *Not Implemented*
| No KDF. Not applicable (keys loaded from files, not derived).

| **RNG**
| ChaCha20-DRBG (512-bit seed, SP 800-90Ar1)
| ‚ùå *Not Implemented*
| Uses OS RNG via OpenSSL (`/dev/urandom`). No deterministic RNG.

| **User-Friendly Hash Names**
| Base32(SHAKE256) ‚Üí Wordlist
| ‚ùå *Not Implemented*
| Uses hex for hashes. Could add wordlist encoding in future.

| **Database Hashing**
| BLAKE3 (512-bit) + SHAKE3-512
| ‚ö†Ô∏è  *Partial*
| Have: BLAKE3 (256-bit). Need: 512-bit output, SHAKE3-512 for long-term storage.

| **Semantic XML/GraphQL**
| Virtuoso (VOS) + SPARQL 1.2, WCAG 2.3 AAA
| ‚ùå *Not Applicable*
| Cerro Torre is a container tool, not a database or web service.

| **VM/Execution**
| GraalVM with formal verification
| ‚ùå *Not Applicable*
| Cerro Torre is a native Ada/SPARK binary, not a VM-based system.

| **Protocol Stack**
| QUIC + HTTP/3 + IPv6 only
| ‚ö†Ô∏è  *Partial*
| Have: HTTP/2 + IPv4/IPv6. Need: Upgrade to HTTP/3, deprecate IPv4.

| **Accessibility**
| WCAG 2.3 AAA + ARIA + Semantic XML
| ‚ùå *Not Applicable*
| Cerro Torre is a CLI tool, not a web application.

| **Fallback PQ Signature**
| SPHINCS+
| ‚ùå *Not Implemented*
| No SPHINCS+ support. ML-DSA-87 is only PQ signature algorithm.

| **Formal Verification**
| Coq/Isabelle for crypto primitives
| ‚úÖ *Implemented*
| Ada/SPARK formal verification in `cerro_crypto.ads`. Idris2/ATS2 in R-/X- variants.

|===

== What Cerro Torre Has Implemented

=== ‚úÖ Fully Implemented

. **Ed25519 Classical Signatures** (`cerro_crypto.ads`)
** Verify_Ed25519: Signature verification
** Full SPARK formal verification
** Production-ready

. **SHA-256/SHA-384/SHA-512** (`cerro_crypto.ads`)
** Compute_SHA256, Compute_SHA512
** SPARK-verified implementations
** Used for bundle hashing and provenance

. **BLAKE3** (`cerro_crypto.ads`)
** Hash_Algorithm enum includes Blake3
** Fast hashing for large files
** Used in performance-critical paths

. **Shake256** (`cerro_crypto.ads`)
** FIPS 202 compliant
** Used for extensible-output hashing
** Can generate arbitrary-length outputs

. **Formal Verification** (Ada/SPARK)
** All crypto operations have SPARK contracts
** Preconditions, postconditions, invariants
** Proven free of runtime errors

=== ‚ö†Ô∏è  Partially Implemented (Stubs)

. **ML-DSA-87 (Dilithium5, FIPS 204)** (`ct_pqcrypto.ads`)
** API fully defined
** Type system: ML_DSA_87_Public_Key (2592 bytes), ML_DSA_87_Signature (4627 bytes)
** Functions: Sign_ML_DSA_87, Verify_ML_DSA_87
** Status: Returns `Not_Implemented` (awaiting liboqs bindings)

. **CT-SIG-02 Hybrid Signatures** (`ct_pqcrypto.ads`)
** Hybrid: Ed25519 (64 bytes) + ML-DSA-87 (4627 bytes) = 4691 bytes
** API: Sign_Hybrid, Verify_Hybrid
** Can extract/combine individual signatures
** Status: Ed25519 works, ML-DSA-87 part is stub

=== ‚ùå Not Implemented (Needed for Svalinn Spec Compliance)

. **Ed448** - Stronger than Ed25519 (57-byte keys vs 32-byte)
. **SHAKE3-512** - Newer, stronger variant of SHAKE
. **Kyber-1024** - PQ KEM (not needed for signing use case)
. **XChaCha20-Poly1305** - Symmetric encryption (not needed for signing)
. **HKDF-SHAKE512** - Key derivation (not needed for signing)
. **ChaCha20-DRBG** - Deterministic RNG (uses OS RNG instead)
. **SPHINCS+** - Conservative PQ fallback
. **HTTP/3** - Currently uses HTTP/2
. **IPv6-only mode** - Currently supports IPv4+IPv6

== Gap Analysis

=== Critical Gaps (Block Production Use Against Quantum Threats)

. **ML-DSA-87 Implementation** (stub only)
** Impact: HIGH
** No post-quantum signature verification
** Recommendation: Prioritize liboqs bindings

. **Ed448 Support** (missing)
** Impact: MEDIUM
** Ed25519 is sufficient for now, but Ed448 is stronger
** Recommendation: Add after ML-DSA-87 is working

. **SPHINCS+ Fallback** (missing)
** Impact: LOW (ML-DSA-87 is primary)
** Conservative backup if ML-DSA-87 breaks
** Recommendation: Add in 2.0 release

=== Non-Critical Gaps (Nice to Have)

. **SHAKE3-512** (have SHAKE256)
** Impact: LOW
** SHAKE256 is sufficient for current use
** Recommendation: Upgrade when SHAKE3 is more widely adopted

. **HTTP/3** (have HTTP/2)
** Impact: LOW
** HTTP/2 is sufficient for registry communication
** Recommendation: Upgrade when HTTP/3 libraries stabilize

. **IPv6-only mode** (have dual-stack)
** Impact: VERY LOW
** IPv4 still needed for many registries
** Recommendation: Add toggle flag, don't force IPv6-only

=== Not Applicable Gaps (Out of Scope)

These are required by svalinn-project but not applicable to Cerro Torre:

- Password hashing (Argon2id) - No passwords, uses public key crypto
- Symmetric encryption (XChaCha20) - No encryption, signs but doesn't encrypt
- KEM (Kyber-1024) - No key exchange, uses signatures
- KDF (HKDF) - Keys loaded from files, not derived
- Database/XML/GraphQL - CLI tool, not a database
- Accessibility (WCAG) - CLI tool, not a web app

== Roadmap to Full Compliance

=== Phase 1: Complete PQ Signatures (MVP ‚Üí 1.0)

[cols="1,2,1",options="header"]
|===
| Task | Description | Priority

| Implement ML-DSA-87
| Link liboqs, implement Sign_ML_DSA_87 / Verify_ML_DSA_87
| üî¥ CRITICAL

| Test CT-SIG-02 Hybrid
| End-to-end testing of Ed25519 + ML-DSA-87
| üî¥ CRITICAL

| Formal Verification
| Extend SPARK proofs to cover PQ crypto bindings
| üü° HIGH

|===

=== Phase 2: Upgrade Classical Crypto (1.0 ‚Üí 1.5)

[cols="1,2,1",options="header"]
|===
| Task | Description | Priority

| Add Ed448 Support
| Replace Ed25519 with Ed448 (or hybrid both)
| üü° HIGH

| Upgrade to SHAKE3-512
| Replace SHAKE256 with SHAKE3-512
| üü¢ MEDIUM

| BLAKE3 512-bit Output
| Extend BLAKE3 to support 512-bit hashes
| üü¢ MEDIUM

|===

=== Phase 3: Add Fallback Algorithms (1.5 ‚Üí 2.0)

[cols="1,2,1",options="header"]
|===
| Task | Description | Priority

| Add SPHINCS+ Support
| Fallback PQ signature algorithm
| üü¢ MEDIUM

| HTTP/3 Support
| Upgrade registry client to HTTP/3
| üü¢ MEDIUM

| IPv6-only Mode
| Add flag to disable IPv4
| ‚ö™ LOW

|===

=== Phase 4: Nice-to-Have Features (2.0+)

[cols="1,2,1",options="header"]
|===
| Task | Description | Priority

| User-Friendly Hash Names
| Base32(SHAKE256) + wordlist
| ‚ö™ LOW

| Deterministic RNG
| ChaCha20-DRBG for reproducible testing
| ‚ö™ LOW

|===

== Comparison with Other Projects

=== Svalinn Project

**Purpose:** General-purpose secure system (database, web, VM)
**Crypto:** Full stack (PQ sigs, KEM, symmetric, KDF, RNG, passwords)
**Scope:** Very broad (includes GUI, accessibility, databases)

Cerro Torre is a *subset* - focuses only on container signing/verification.

=== Sigstore/Cosign

**Purpose:** Container signing (similar to Cerro Torre)
**Crypto:** Ed25519, ECDSA, RSA (no PQ yet)
**Scope:** Similar to Cerro Torre

Cerro Torre is *more advanced* - has PQ crypto roadmap (ML-DSA-87, CT-SIG-02).

=== TUF (The Update Framework)

**Purpose:** Software update security
**Crypto:** Ed25519, RSA (no PQ yet)
**Scope:** Software updates, not containers

Cerro Torre is *more specialized* - container-specific with SBOM/provenance.

== Recommendations

=== For Cerro Torre Development

. **Prioritize ML-DSA-87 implementation** - This is the critical gap for quantum resistance
. **Don't implement out-of-scope features** - No passwords, symmetric crypto, or KEM (not needed for signing)
. **Upgrade classical crypto gradually** - Ed448 and SHAKE3-512 can wait until ML-DSA-87 works
. **Keep formal verification** - Cerro Torre's Ada/SPARK verification is a competitive advantage

=== For Svalinn Project Integration

If Cerro Torre is to be integrated into the broader svalinn ecosystem:

. **Use svalinn crypto library** - Don't duplicate implementations
. **Cerro Torre provides** - Container signing/verification APIs
. **Svalinn provides** - Crypto primitives (Argon2id, Kyber, XChaCha20, etc.)
. **Integration point** - Cerro Torre calls svalinn crypto functions via Ada bindings

=== For Users

Current Cerro Torre security:

- ‚úÖ *Classical threats:* Fully protected (Ed25519, SHA-256, BLAKE3)
- ‚ö†Ô∏è  *Quantum threats:* NOT protected (ML-DSA-87 is stub only)
- ‚úÖ *Formal verification:* SPARK proves correctness of implemented algorithms

**Safe to use today for:**
- Development/testing (quantum computers not yet a threat)
- Classical threat model (nation-state attackers without quantum computers)

**NOT safe to use for:**
- Long-term secrets (must survive 20+ years into quantum era)
- Highly sensitive data (requires quantum-resistant signatures NOW)

== Conclusion

Cerro Torre implements *40% of svalinn-project crypto requirements*:

- ‚úÖ Classical crypto (Ed25519, SHA-256, BLAKE3, Shake256)
- ‚ö†Ô∏è  Post-quantum crypto (API designed, awaiting implementation)
- ‚ùå Out-of-scope features (passwords, symmetric, KEM, web accessibility)

**Next steps:**
1. Complete ML-DSA-87 implementation (link liboqs)
2. Test CT-SIG-02 hybrid signatures end-to-end
3. Upgrade to Ed448 and SHAKE3-512
4. Add SPHINCS+ fallback

**Timeline estimate:**
- Phase 1 (PQ sigs): 2-3 months
- Phase 2 (upgrade classical): 1-2 months
- Phase 3 (fallbacks): 1-2 months
- **Total: 4-7 months to full compliance**

Yes, the svalinn-project spec you provided appears to be the original security standard that Cerro Torre should eventually align with, but many features (passwords, KEM, symmetric crypto) are out of scope for a container signing tool.
