= Basic Example - Web Application Stack
:toc:

== Overview

This example demonstrates a typical web application stack:

* **Frontend** - Web UI (ReScript + Deno)
* **Backend** - REST API (Rust)
* **PostgreSQL** - Database
* **Redis** - Cache

All services use `.ctp` verified container bundles and communicate via selur's zero-copy IPC.

== Architecture

[source]
----
┌──────────────┐
│   Frontend   │ :3000
│  (ReScript)  │
└──────┬───────┘
       │ HTTP
       ↓
┌──────────────┐
│   Backend    │ :8080
│   (Rust)     │
└──┬───────┬───┘
   │       │
   │ selur │ selur (zero-copy)
   ↓       ↓
┌───────┐ ┌───────┐
│Postgres│ │ Redis │
│  :5432 │ │ :6379 │
└───────┘ └───────┘
----

== Prerequisites

[source,bash]
----
# Install selur-compose
curl -fsSL https://github.com/hyperpolymath/selur-compose/releases/latest/download/install.sh | sh

# Or build from source
git clone https://github.com/hyperpolymath/selur-compose
cd selur-compose
cargo build --release
sudo cp target/release/selur-compose /usr/local/bin/
----

== Quick Start

[source,bash]
----
cd examples/basic

# Verify all .ctp bundles
selur-compose verify

# Start all services
selur-compose up -d

# Check status
selur-compose ps

# View logs
selur-compose logs -f backend

# Access application
curl http://localhost:3000
----

== Services

=== Frontend

* **Image:** `ghcr.io/myorg/frontend:latest.ctp`
* **Port:** 3000
* **Environment:**
  - `BACKEND_URL=http://backend:8080`
  - `NODE_ENV=production`

=== Backend

* **Image:** `ghcr.io/myorg/backend:latest.ctp`
* **Port:** 8080
* **Replicas:** 3 (horizontal scaling)
* **Health Check:** `curl -f http://localhost:8080/health` every 30s
* **Dependencies:** postgres, redis

=== PostgreSQL

* **Image:** `ghcr.io/hyperpolymath/postgres:16.ctp`
* **Port:** 5432
* **Volume:** `pgdata:/var/lib/postgresql/data` (persistent)
* **Environment:**
  - `POSTGRES_DB=myapp`
  - `POSTGRES_PASSWORD=secret`

=== Redis

* **Image:** `ghcr.io/hyperpolymath/redis:7.ctp`
* **Port:** 6379
* **Volume:** `redisdata:/data` (persistent)

== Deployment Order

selur-compose automatically resolves dependencies:

1. **postgres** (no dependencies)
2. **redis** (no dependencies)
3. **backend** (depends on postgres, redis)
4. **frontend** (depends on backend)

== Scaling

[source,bash]
----
# Scale backend to 5 replicas
selur-compose scale backend=5

# Check replica distribution
selur-compose ps
----

== Cleanup

[source,bash]
----
# Stop all services
selur-compose down

# Stop and remove volumes
selur-compose down -v
----

== Performance

With selur zero-copy IPC:

* **Backend ↔ PostgreSQL:** <50 μs per query (vs 200-500 μs with JSON/HTTP)
* **Backend ↔ Redis:** <30 μs per command (vs 150-300 μs)
* **Throughput:** 10,000+ req/s per service pair

== Security

All `.ctp` bundles are:

* ✅ Cryptographically signed
* ✅ SBOM validated
* ✅ Transparency log verified
* ✅ Policy compliant

View bundle details:

[source,bash]
----
selur-compose sbom backend
selur-compose provenance frontend
----
