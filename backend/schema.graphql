# SPDX-License-Identifier: PMPL-1.0-or-later
# GraphQL Schema for stapeln (MVP)

scalar JSON
scalar DateTime

enum RuntimeEngine {
  PODMAN
  DOCKER
  NERDCTL
}

type Position {
  x: Float!
  y: Float!
}

type Component {
  id: ID!
  type: String!
  position: Position!
  config: JSON
}

type Connection {
  id: ID!
  from: ID!
  to: ID!
}

type Stack {
  id: ID!
  name: String!
  description: String
  runtime: RuntimeEngine!
  components: [Component!]!
  connections: [Connection!]!
  createdAt: DateTime!
  updatedAt: DateTime!
}

input PositionInput {
  x: Float!
  y: Float!
}

input ComponentInput {
  id: ID
  type: String!
  position: PositionInput!
  config: JSON
}

input ConnectionInput {
  id: ID
  from: ID!
  to: ID!
}

input CreateStackInput {
  name: String!
  description: String
  runtime: RuntimeEngine!
  components: [ComponentInput!]!
  connections: [ConnectionInput!]!
}

input UpdateStackInput {
  name: String
  description: String
  runtime: RuntimeEngine
  components: [ComponentInput!]
  connections: [ConnectionInput!]
}

type Query {
  stack(id: ID!): Stack
  stacks(limit: Int = 50): [Stack!]!
}

type Mutation {
  createStack(input: CreateStackInput!): Stack!
  updateStack(id: ID!, input: UpdateStackInput!): Stack!
  deleteStack(id: ID!): Boolean!
}
